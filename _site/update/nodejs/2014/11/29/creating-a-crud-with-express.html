<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Creating a Crud with Express</title>
  <meta name="description" content="Step by step guide to create a CRUD with Express 4 and mongoose.">

  <!-- facebook OG tags -->
<meta content="1037408686315344" property="fb:app_id">
<meta content="Cristian Cortez" property="og:site_name">

  <meta content="Creating a Crud with Express" property="og:title">


  <meta content="article" property="og:type">


  <meta content="Learn how to create a Express 4.x CRUD" property="og:description">


  <meta content="https://cortezcristian.github.io/update/nodejs/2014/11/29/creating-a-crud-with-express.html" property="og:url">


  <meta content="2014-11-29T23:01:44-03:00" property="article:published_time">
  <meta content="https://cortezcristian.github.io/about/" property="article:author">


  <meta content="https://cortezcristian.github.io/assets/img/cortezcristian.jpg" property="og:image">


  
  <!-- <meta content="update" property="article:section"> -->
  


  


<!-- Twitter cards metatags -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@cortezcristian">
<meta name="twitter:creator" content="@cortezcristian">

  <meta name="twitter:title" content="Creating a Crud with Express">


  <meta name="twitter:url" content="https://cortezcristian.github.io/update/nodejs/2014/11/29/creating-a-crud-with-express.html">


  <meta name="twitter:description" content="Learn how to create a Express 4.x CRUD">




  <!-- bower:css -->
  <link rel="stylesheet" href="https://cortezcristian.github.io/bower_components/components-font-awesome/css/font-awesome.css" />
  <!-- endbower -->

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://cortezcristian.github.io/update/nodejs/2014/11/29/creating-a-crud-with-express.html">
  <link rel="alternate" type="application/rss+xml" title="Cristian Cortez" href="https://cortezcristian.github.io/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Cristian Cortez</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <div class="container">
    <div class="row ">
        <div class="col-xs-8 col-xs-offset-2">

        <!-- Twitter -->
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="cortezcristian">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

        <!-- Google + -->
        <div class="g-plus" data-action="share" data-annotation="bubble"></div>
        <script src="https://apis.google.com/js/platform.js" async defer></script>

        <!-- Facebook -->
        <div class="fb-share-button" data-href="https://cortezcristian.github.io/update/nodejs/2014/11/29/creating-a-crud-with-express.html" data-layout="button_count" style="position: relative; top: -8px; left: 33px;"></div>
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/es_LA/sdk.js#xfbml=1&version=v2.5&appId=1037408686315344";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>

    </div>
    </div>
</div>

    <h1 class="post-title" itemprop="name headline">Creating a Crud with Express</h1>
    <p class="post-meta"><time datetime="2014-11-29T23:01:44-03:00" itemprop="datePublished">Nov 29, 2014</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Step by step guide to create a CRUD with Express 4 and mongoose.</p>

<h2 id="setup">Setup</h2>

<p>Install yeoman and express generator</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo npm install -g yo generator-express bower grunt-cli
</code></pre>
</div>

<p>Generate a new express site, choosing Basic, Jade and Grunt</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mkdir crudtest &amp;&amp; cd crudtest
$ yo express
[?] Select a version to install: (Use arrow keys)
‣ Basic
  MVC
[?] Select a view engine to use: (Use arrow keys)
‣ Jade
  EJS

</code></pre>
</div>

<p>A folder structure will be automatically generated:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ tree -L 1
.
├── app.js
├── bin
├── bower.json
├── Gruntfile.js
├── LICENSE
├── node_modules
├── package.json
├── public
├── README.md
├── routes
└── views

</code></pre>
</div>

<p>Start the server and browse <a href="http://localhost:3000/">http://localhost:3000/</a> to check it’s working:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm start

&gt; express4crud@0.0.1 start /var/www/express4crud
&gt; node ./bin/www

GET / 200 254.744 ms - 305
GET /css/style.css 200 4.750 ms - 111
GET /favicon.ico 404 29.664 ms - 1173
</code></pre>
</div>
<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/site-express4.png" alt="Express 4" /></p>

<p>You’ll need to have mongoDB installed in order to continue with this tutorial. Please check that you have it up and running before continuing.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mongo
MongoDB shell version: 2.4.11
connecting to: test
&gt;
</code></pre>
</div>

<h2 id="adding-models">Adding Models</h2>

<p>Installing up mongoose</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install --save mongoose
</code></pre>
</div>

<p>After that go ahead and modify <code class="highlighter-rouge">app.js</code>, add the following lines to set the database connection.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code> <span class="kd">var</span> <span class="nx">routes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./routes/index'</span><span class="p">);</span>
 <span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./routes/user'</span><span class="p">);</span>

<span class="o">+</span><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>
<span class="o">+</span>
<span class="o">+</span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'mongodb://localhost/crudtest'</span><span class="p">);</span>
<span class="o">+</span>
 <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

</code></pre>
</div>

<p>We are going to create a folder to store our models:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mkdir models
</code></pre>
</div>

<p>Our first model will look like this <code class="highlighter-rouge">models/persons.js</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">personSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="na">age</span><span class="p">:</span> <span class="nb">Number</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">personModel</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">'Persons'</span><span class="p">,</span> <span class="nx">personSchema</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">personModel</span><span class="p">;</span>

</code></pre>
</div>

<p>As you can see it’s a very simple model, we can create a test file to prove it works:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mkdir test
</code></pre>
</div>

<p>Just to create a simple test we can create a file called: <code class="highlighter-rouge">test/persons-tests.js</code> with this content:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/persons'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose'</span><span class="p">);</span>

<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'mongodb://localhost/crudtest'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span><span class="s2">"Cristian"</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span><span class="mi">27</span> <span class="p">});</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
<span class="p">});</span>

</code></pre>
</div>

<p>If we run it we should be able to see the following</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ node test/persons-tests.js
null { __v: 0,
  name: 'Cristian',
  age: 27,
  _id: 545ed9517520ef9e153a877e }
^C
</code></pre>
</div>

<p>To validate this we can inspect our Mongo Database directly by doing:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ mongo
MongoDB shell version: 2.4.11
connecting to: test
&gt; show dbs;
crudtest	0.203125GB
test	0.203125GB
local	0.078125GB
&gt; use crudtest
switched to db crudtest
&gt; show collections
persons
system.indexes
&gt; db.persons.find()
{ "name" : "Cristian", "age" : 27, "_id" : ObjectId("545ed9517520ef9e153a877e"), "__v" : 0 }
&gt; ^C
bye

</code></pre>
</div>

<h2 id="modifying-routes">Modifying Routes</h2>

<p>We are going to create a new file <code class="highlighter-rouge">routes/main.js</code> and we are going to include it in our <code class="highlighter-rouge">app.js</code> file. Right after the express config:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span>
  <span class="na">extended</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'public'</span><span class="p">)));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nx">routes</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/users'</span><span class="p">,</span> <span class="nx">users</span><span class="p">);</span>

<span class="o">+</span><span class="nx">require</span><span class="p">(</span><span class="s1">'./routes/main.js'</span><span class="p">);</span>
<span class="c1">/// catch 404 and forward to error handler</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</code></pre>
</div>
<p>We are generating a parent -&gt; child relationship between the 2 files <code class="highlighter-rouge">app.js</code> -&gt; <code class="highlighter-rouge">routes/main.js</code>. To gain access to parent file variables from the child file we need to add this change in  <code class="highlighter-rouge">app.js</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'mongodb://localhost/crudtest'</span><span class="p">);</span>

<span class="o">+</span><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">// view engine setup</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'views'</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'views'</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'view engine'</span><span class="p">,</span> <span class="s1">'jade'</span><span class="p">);</span>

</code></pre>
</div>

<p>So the relationship it’s like this:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Parent File</th>
      <th style="text-align: left">Included File (child)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">app.js</td>
      <td style="text-align: left">routes/main.js</td>
    </tr>
    <tr>
      <td style="text-align: left">exports.app</td>
      <td style="text-align: left">module.parent.exports.app</td>
    </tr>
  </tbody>
</table>

<p>Now we are going to create a new page to list our persons, in <code class="highlighter-rouge">routes/main.js</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">app</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'It works!'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Let’s reset the web server and test the new route <a href="http://localhost:3000/list">http://localhost:3000/list</a></p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/route-list-test.png" alt="List Route" /></p>

<p>Let’s hookup the models now into our <code class="highlighter-rouge">routes/main.js</code>, see the changes:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code> <span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">app</span><span class="p">;</span>
<span class="o">+</span><span class="kd">var</span> <span class="nx">Persons</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/persons.js'</span><span class="p">);</span>

 <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="o">-</span>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'It works!'</span><span class="p">);</span>
<span class="o">+</span>    <span class="nx">Persons</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">){</span>
<span class="o">+</span>        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">docs</span><span class="p">);</span>
<span class="o">+</span>    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<p>Notice <code class="highlighter-rouge">Query#find([criteria], [callback])</code> is a built-in feature from <a href="http://mongoosejs.com/docs/api.html#query_Query-find">Mongoose API</a>.</p>

<p>Restart the server and go to <a href="http://localhost:3000/list">http://localhost:3000/list</a> again:
<img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/list-json.png" alt="List JSON example" /></p>

<h2 id="creating-a-view">Creating a view</h2>

<p>Let’s change all that a little bit to display a page with an HTML table instead of a plain JSON response. First create a new template called <code class="highlighter-rouge">views/list.jade</code> based on an existing one.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cp views/index.jade views/list.jade
</code></pre>
</div>

<p>Let’s link that view to our existing route:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">app</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">Persons</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/persons.js'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">Persons</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">){</span>
<span class="o">-</span>        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">docs</span><span class="p">);</span>
<span class="o">+</span>        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'list'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'List'</span><span class="p">,</span> <span class="na">persons</span><span class="p">:</span> <span class="nx">docs</span><span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>
<p>If we restart the server again, we should be able to see:</p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/list-view.png" alt="List View" /></p>

<p>Notice that we are passing to the view an object with the list of <code class="highlighter-rouge">persons</code>. Let’s modify our <code class="highlighter-rouge">views/list.jade</code> file to display this data in table form:</p>

<pre><code class="language-jade">extends layout

block content
  h1= title
  p=JSON.stringify(persons)
  p
    a(href="/p/new") New
  table
    tr
      th N
      th Name
      th Age
      th Options
    - persons.forEach(function(v,i){
    tr
      td=i
      td=v.name
      td #{v.age} years
      td
        a(href="/p/edit/"+v._id) Edit
        |
        a(href="/p/delete/"+v._id) Delete
    - });
</code></pre>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/list-view-table.png" alt="List View Table" /></p>

<p>Notice we already put in place some links to redirect to create, edit and delete sections.</p>

<h2 id="inserting-a-record">Inserting a record</h2>

<p>Let’s move forward with the person creation:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cp views/index.jade views/new.jade
</code></pre>
</div>

<p>Let’s add the route to link the new view. See <code class="highlighter-rouge">routes/main.js</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">app</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">Persons</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/persons.js'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">Persons</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'list'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'List'</span><span class="p">,</span> <span class="na">persons</span><span class="p">:</span> <span class="nx">docs</span><span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="o">+</span>
<span class="o">+</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/p/new'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="o">+</span>    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'new'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'New'</span><span class="p">});</span>
<span class="o">+</span><span class="p">});</span>

</code></pre>
</div>

<p>And finally change the view <code class="highlighter-rouge">views/new.jade</code>:</p>

<pre><code class="language-jade">extends layout

block content
  h1= title
  form(action='',method='post')
    div
      label(for='name') Name:
      input(type='text', name='name', id='name', placeholder='Name here...')
    div
      label(for='age') Age:
      input(type='text', name='age', id='age', placeholder='Age...')
    div
      input(type='submit', value='Save')
  style.
    form label { min-width: 80px; display: inline-block; }
    form &gt; div { padding: 5px; }
</code></pre>

<p>It should look like this:</p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/new-view.png" alt="New View" /></p>

<p>At this point we only create the GET url for displaying the form, now we need to define the POST url to receive the parameters every time the user submits the form.</p>

<p>Modify the <code class="highlighter-rouge">routes/main.js</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">app</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">Persons</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/persons.js'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">Persons</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'list'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'List'</span><span class="p">,</span> <span class="na">persons</span><span class="p">:</span> <span class="nx">docs</span><span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/p/new'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'new'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'New'</span><span class="p">});</span>
<span class="p">});</span>

 <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/p/new'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="o">-</span>    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'new'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'New'</span><span class="p">});</span>
<span class="o">+</span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="o">+</span>    <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Persons</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">age</span> <span class="p">});</span>
<span class="o">+</span>    <span class="nx">p</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">){</span>
<span class="o">+</span>        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">){</span>
<span class="o">+</span>            <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">);</span>
<span class="o">+</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="o">+</span>            <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="o">+</span>        <span class="p">}</span>
<span class="o">+</span>    <span class="p">});</span>
 <span class="p">});</span>
</code></pre>
</div>

<p>Go to <a href="http://localhost:3000/p/new">http://localhost:3000/p/new</a> and submit a new person:</p>

<p><img src="https://github.com/cortezcristian/express4crud/blob/master/pics/save-first-record.png" alt="New Perrson Submit" /></p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm start

&gt; express4crud@0.0.1 start /var/www/express4crud
&gt; node ./bin/www

GET /p/new 200 254.582 ms - 662
GET /css/style.css 200 7.502 ms - 111
{ name: 'John', age: '22' }
POST /p/new 302 411.564 ms - 66
GET /list 200 286.316 ms - 978
GET /css/style.css 200 20.991 ms - 111
</code></pre>
</div>

<p>If everything works fine you’ll be redirected to <code class="highlighter-rouge">/list</code>:</p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/list-view-new.png" alt="List View New" /></p>

<h2 id="delete-a-record">Delete a record</h2>
<p>Remember that for deleting a record we previously created a link that is passing the ObjectId of the document as parameter in the url <code class="highlighter-rouge">/p/delete/:id</code>. Let’s modify our routes file <code class="highlighter-rouge">routes/main.js</code> to add the remove url.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">app</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">Persons</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/persons.js'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">Persons</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'list'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'List'</span><span class="p">,</span> <span class="na">persons</span><span class="p">:</span> <span class="nx">docs</span><span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/p/new'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'new'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'New'</span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/p/new'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Persons</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">age</span> <span class="p">});</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="o">+</span>
<span class="o">+</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/p/delete/:id'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="o">+</span>    <span class="nx">Persons</span><span class="p">.</span><span class="nx">remove</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">){</span>
<span class="o">+</span>        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">){</span>
<span class="o">+</span>            <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">);</span>
<span class="o">+</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="o">+</span>            <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="o">+</span>        <span class="p">}</span>
<span class="o">+</span>    <span class="p">});</span>
<span class="o">+</span><span class="p">});</span>
</code></pre>
</div>

<p>If we go ahead and delete the previous record we created, the console output will look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm start

&gt; express4crud@0.0.1 start /var/www/express4crud
&gt; node ./bin/www

GET /list 200 545.345 ms - 581
GET /p/delete/5460d48969d6ee103e4f8c56 302 213.596 ms - 66
GET /list 200 545.345 ms - 581
GET /css/style.css 200 6.062 ms - 111
</code></pre>
</div>

<p>If everything works fine you’ll be redirected to <code class="highlighter-rouge">/list</code>:</p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/list-view-deleted.png" alt="List View Deleted" /></p>

<p>Notice that in my example record John doesn’t exist anymore.</p>

<h2 id="edit-a-record">Edit a record</h2>
<p>Editing a record will have a little bit more of complexity. Let’s start by creating a new view for it.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cp views/new.jade views/edit.jade
</code></pre>
</div>

<p>And create a fresh route, to get the document by ObjectId in <code class="highlighter-rouge">./routes/main.js</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/p/edit/:id'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">Persons</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'edit'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="na">person</span><span class="p">:</span> <span class="nx">doc</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>

</code></pre>
</div>

<p>And let’s modify the view <code class="highlighter-rouge">views/edit.jade</code> to display the values:</p>

<pre><code class="language-jade">extends layout

block content
  h1= title
  p=JSON.stringify(person)
  form(action='',method='post')
    div
      label(for='name') Name:
      input(type='text', name='name', id='name', placeholder='Name here...', value=person.name)
    div
      label(for='age') Age:
      input(type='text', name='age', id='age', placeholder='Age...', value=person.age)
    div
      input(type='submit', value='Save')
  style.
    form label { min-width: 80px; display: inline-block; }
    form &gt; div { padding: 5px; }

</code></pre>

<p>At this point the Edit page should look like this:</p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/edit-view.png" alt="Edit View" /></p>

<p>We need to create the POST url to actually modify and persist person data inside <code class="highlighter-rouge">./routes/main.js</code>. Just add this lines:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/p/edit/:id'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
    <span class="nx">Persons</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">){</span>
            <span class="nx">doc</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
            <span class="nx">doc</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">age</span><span class="p">;</span>
            <span class="nx">doc</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">){</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>

</code></pre>
</div>

<p>Let’s edit our existing document to increment the age from 27 to 28:</p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/view-edit-age.png" alt="Edit Age" /></p>

<p>If everything works fine you’ll be redirected to <code class="highlighter-rouge">/list</code>:</p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/list-view-edited.png" alt="List View Edited" /></p>

<p>Notice our record says now 28 instead of 27.</p>

<h2 id="flash-messages">Flash Messages</h2>

<p>Let’s imagine that in a more complex scenario you need to implement error messages between the request. The case could be something like:</p>

<ol>
  <li>The user edits the form (GET request /p/edit/:id)</li>
  <li>The user submits new data (POST request /p/edit/:id), and submits something that is not a Number into the age field.</li>
  <li>So instead of redirecting to <code class="highlighter-rouge">/list</code>. We run some backend validation and show an error message indicating the problem. (GET request /p/edit/:id)</li>
</ol>

<p>In order to resolve this problem we will need to manage session data (<a href="https://www.npmjs.org/package/express-session">express-session</a>) and be able to save and fetch those messages (<a href="https://www.npmjs.org/package/connect-flash">connect-flash</a>). Let’s install those packages by doing:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>npm install --save express-session connect-flash
</code></pre>
</div>

<p>After that we’ll need to make some adjustments to our <code class="highlighter-rouge">app.js</code>.</p>

<p>Let’s declare our new dependecies at the very top:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">favicon</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'serve-favicon'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'morgan'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cookieParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'cookie-parser'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'body-parser'</span><span class="p">);</span>
<span class="o">+</span><span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express-session'</span><span class="p">)</span>
<span class="o">+</span><span class="kd">var</span> <span class="nx">flash</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'connect-flash'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">routes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./routes/index'</span><span class="p">);</span>

</code></pre>
</div>

<p>And then call them around line 26, right after cookie parser usage declaration:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span>
 <span class="p">}));</span>
 <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cookieParser</span><span class="p">());</span>
 <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'public'</span><span class="p">)));</span>
<span class="o">+</span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">({</span><span class="na">secret</span><span class="p">:</span> <span class="s1">'supersecret'</span><span class="p">,</span> <span class="na">saveUninitialized</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">resave</span><span class="p">:</span> <span class="kc">true</span><span class="p">}));</span>
<span class="o">+</span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">flash</span><span class="p">());</span>

 <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nx">routes</span><span class="p">);</span>
 <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/users'</span><span class="p">,</span> <span class="nx">users</span><span class="p">);</span>
</code></pre>
</div>

<p>To probe our flash message system is working we can do the following. Once the user visit <code class="highlighter-rouge">/p/new</code> url and get redirect to <code class="highlighter-rouge">/list</code> we are going to display a message. In our routes file <code class="highlighter-rouge">./routes/main.js</code>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/list'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="o">+</span>    <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">'message'</span><span class="p">);</span> <span class="c1">// Read the flash message</span>
     <span class="nx">Persons</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">docs</span><span class="p">){</span>
<span class="o">-</span>        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'list'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'List'</span><span class="p">,</span> <span class="na">persons</span><span class="p">:</span> <span class="nx">docs</span><span class="p">});</span>
<span class="o">+</span>        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'list'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'List'</span><span class="p">,</span> <span class="na">persons</span><span class="p">:</span> <span class="nx">docs</span><span class="p">,</span> <span class="na">flashmsg</span><span class="p">:</span> <span class="nx">msg</span><span class="p">});</span> <span class="c1">// Pass Flash Message to the view</span>
     <span class="p">});</span>
 <span class="p">});</span>

 <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/p/new'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="o">+</span>    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="s1">'You visited /new'</span><span class="p">);</span> <span class="c1">// Save the flash message</span>
     <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'new'</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="s1">'New'</span><span class="p">});</span>
 <span class="p">});</span>
</code></pre>
</div>

<p>We also need to make some adjustment to display the saved flash message inside <code class="highlighter-rouge">views/list.jade</code>:</p>

<pre><code class="language-jade">extends layout

 block content
   h1= title
-  //p=JSON.stringify(persons)
+  p=JSON.stringify(flashmsg)
   p
     a(href="/p/new") New
   table
</code></pre>

<p>If we go ahead and create a new person, when you get redirected back to <code class="highlighter-rouge">/list</code> you’ll be able to see the flash message:</p>

<p><img src="https://raw.githubusercontent.com/cortezcristian/express4crud/master/pics/flash-message.png" alt="Flash Message" /></p>

<h2 id="final">Final</h2>
<p>If you want to see the complete demo, you can go ahead and clone this repo.</p>

<ul>
  <li><a href="https://github.com/cortezcristian"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg>
</span><span class="username">cortezcristian</span></a>
 /
<a href="https://github.com/cortezcristian/express4crud">express4crud</a></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git clone git@github.com:cortezcristian/express4crud.git
</code></pre>
</div>

<h2 id="moving-forward">Moving Forward</h2>

<p>During this tutorial we’ve been generating different routes with crud functionallity. It’ll be good to add an authentication layer, to prevent unauthorized visitors access our CRUD functionallity. That’ll be our next tutorial <a href="https://github.com/cortezcristian/express4passport-local">Express 4.x and Passport Auth Layer</a>.</p>

  </div>

</article>

<!--  Disqus comments -->

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//cortezcristian.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Cristian Cortez</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Cristian Cortez</li>
          <li><a href="mailto:cortez.cristian@gmail.com">cortez.cristian@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/cortezcristian"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">cortezcristian</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/cortezcristian"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">cortezcristian</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Serial entrepreneur & Full-stack developer. Trainer on new technologies and creator of @emprendevs
</p>
      </div>
    </div>

  </div>

</footer>

<!-- bower:js -->
<!-- endbower -->

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
      var pageTracker = _gat._getTracker("UA-61105584-1");
      pageTracker._trackPageview();
    } catch(err) {}
</script>


  </body>

</html>
